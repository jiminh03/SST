erDiagram
    %% --- Entities Definition ---

    STAFFS {
        int staff_id PK "직원 고유 ID"
        string login_id UK "로그인 ID"
        string password_hash "비밀번호 해시"
        string full_name "이름"
        string role "역할 (e.g., admin, caregiver)"
        datetime created_at "생성일"
    }

    SENIORS {
        int senior_id PK "어르신 고유 ID"
        string full_name "이름"
        string address "주소"
        json health_info "건강 정보 (지병, 복용약 등)"
        datetime created_at "등록일"
    }

    STAFF_SENIOR_MAP {
        int map_id PK "맵 고유 ID"
        int staff_id PK, FK "직원 ID"
        int senior_id PK, FK "어르신 ID"
    }

    IOT_HUBS {
        int hub_id PK "홈 허브 고유 ID"
        int senior_id FK "연결된 어르신 ID"
        string unique_id UK "기기 고유 번호 (e.g., MAC 주소)"
        string api_key_hash "발급된 API 키 해시"
        string status "상태 (e.g., online, offline)"
        datetime last_seen_at "마지막 접속 시간"
        datetime registered_at "등록일"
    }

    AI_WEIGHTS {
        int weight_id PK "가중치 고유 ID"
        int senior_id FK "대상 어르신 ID"
        int version "버전"
        string storage_path "가중치 파일 경로 (Object Storage)"
        boolean is_active "현재 사용 여부"
        datetime created_at "생성일"
    }

    EMERGENCY_LOGS {
        int log_id PK "로그 고유 ID"
        int senior_id FK "대상 어르신 ID"
        string event_type "이벤트 종류 (e.g., fall_detection)"
        string description "상세 내용"
        datetime occurred_at "발생 시각"
        datetime resolved_at "조치 완료 시각"
    }

    VISIT_SCHEDULES {
    int visit_id PK "방문 스케줄 ID"
    int map_id FK "관리 관계 ID (STAFF_SENIOR_MAP)"
    datetime visit_datetime "방문 예정 일시"
    string status "상태 (e.g., scheduled, completed, cancelled)"
    text report "방문 결과 보고"
    datetime created_at "생성일"
}

    %% --- Time-Series Data (Logical Representation) ---
    %% 시계열 데이터(센서 로그)는 별도의 Time-Series DB(e.g., TimescaleDB)에 저장됩니다.
    %% 아래는 개념적 표현이며, 실제 테이블은 관계형 DB에 존재하지 않습니다.
    SENSOR_LOGS {
        datetime timestamp "타임스탬프"
        string sensor_id "센서 위치/ID"
        string event_content "이벤트 내용"
        boolean sensor_value "센서 값 (True/False)"
        int hub_id "로그를 전송한 홈 허브 ID"
    }


    %% --- Relationships Definition ---

    STAFFS ||--|{ STAFF_SENIOR_MAP : "manages"
    SENIORS ||--|{ STAFF_SENIOR_MAP : "is managed by"

    SENIORS ||--|| IOT_HUBS : "has one"
    SENIORS ||--|{ AI_WEIGHTS : "has personal"
    SENIORS ||--|{ EMERGENCY_LOGS : "has"
    
    STAFF_SENIOR_MAP ||--|{ VISIT_SCHEDULES : "schedules"