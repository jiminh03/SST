# 백엔드 요구사항 명세

상태: 완료
프로젝트: PJT 2 (https://www.notion.so/PJT-2-259cce47468a80ce83f6c643676c850f?pvs=21)

## 기능적 요구사항

### 1. 독거노인 모니터링 시스템 - 노인 관리 웹 서비스

1. 어르신 목록 조회
    - `[어르신 이름 / 현재 위험도]`형식의 어르신 목록을 제공
2. 어르신 위험도 확인
    - 생활 패턴 분석을 통해 나온 수치에 따라 `안전`/`주의`/`위험` 로 분류하여 제공
    - 일정 주기로 생활 패턴을 분석하여 위험도를 갱신
3. 각 노인에 대한 세부 정보 조회
    - 제공해야될 세부 정보 목록
        - 응급 상황 히스토리: 시스템에서 감지했던 응급 상황에 대한 로그
        - 보편적인 요양 관리 시스템에서 다루는 정보(지병, 복용약 등)
4. 응급 상황 발생시 푸쉬 알림 제공
    - WebSocket 기반으로 브라우저에 실시간 알림을 제공
    - 수신 여부를 확인하기 위해 클라이언트 응답을 확인

### 2. 독거노인 모니터링 시스템 - 응급 현장 스트리밍

1. 로봇에서 송출하는 영상을 홈 허브를 통해 백엔드에서 스트리밍
    - 로봇에서 RTSP같은 미디어 스트리밍 프로토콜로 영상을 송출
    - 홈허브는 FE에 송출할 수 있는 미디어 파이프라인 구축
    - 백엔드는 WebRTC를 통해 홈허브와 FE를 P2P 연결

### 3. 독거노인 모니터링 시스템 - 생활 패턴 분석 및 이상치 감지

1. 개인화된 ai 모델 가중치를 저장
    - 가중치가 그렇게 크지 않을 것을 예상되어 DB의 BLOB에 저장할 예정
    - 또는 가중치 버전 관리를 위해 오브젝트 스토리지도 고려중
2. 여러 노인들의 생활 패턴을 실시간으로 분석 및 비교하여 모니터링
    - 하나의 모델에 대해 여러 가중치를 동적으로 로딩
3. 일정 기간 쌓인 생활 로그를 바탕으로 기존 가중치를 튜닝하는 학습 파이프 라인
    - GPU 기반 학습 서버를 통해 새로운 생활 데이터를 학습하여 가중치 업데이트
4. 예상치 못한 AI 동작에 대한 예외처리
    - 입력값에 대한 예측값이 나오지 않거나 비정상적인 출력이 나오는 경우 이상 패턴으로 감지
    - 비정상 출력에 대한 로그를 남겨서 ai 시스템에 피드백

### 4. Iot 시스템 - 안전 확인 로봇

1. 중앙 서버에서 이상치 발견시 홈 허브를 통해 로봇에게 안전 확인을 요청
2. 안전 확인에서 로봇의 확인 결과를 홈 허브를 통해 수신

### 5. Iot 시스템 - 홈 센서 시스템

1. 홈 허브 인증은 허브 고유 번호를 중앙시스템에 등록하는 방식을 사용
    - 직원 계정으로 홈 허브 고유 번호 정보와 노인 정보를 서버에 전송하면 api키를 발급
2. 센서 동작 로그를 시계열 데이터로써 DB에 저장 및 조회
    - 로그 형식: `[타임스탬프] [센서 위치] [이벤트 내용]`
3. 네트워크 오류에 대한 예외처리
    - 홈 허브와의 네트워크 연결이 안되는 경우 모니터링 시스템에서 통신 안됨을 표시
    - 다시 연결에 성공하였을 경우
        - 쌓여있던 생활 이벤트 로그 일괄 수신
        - 지연된 이벤트 로그도 정상 로그과 동일하게 처리

## 요구사항 확인용 문서

### **1. 노인 관리 웹 서비스**

- **BE-FR-01:** 어르신 목록을 `[이름/현재 위험도]` 형식으로 조회할 수 있어야 한다.
- **BE-FR-02:** 생활 패턴 분석 결과에 따라 어르신의 상태를 `안전`, `주의`, `위험`으로 분류하여 제공해야 한다.
- **BE-FR-03:** 일정 주기로 생활 패턴을 재분석하여 위험도를 갱신해야 한다.
- **BE-FR-04:** 특정 어르신의 응급 상황 발생 이력을 조회할 수 있어야 한다.
- **BE-FR-05:** 특정 어르신의 기본 정보(지병, 복용약 등)를 조회할 수 있어야 한다.
- **BE-FR-06:** 응급 상황 발생 시, WebSocket을 통해 관리자 웹에 실시간으로 알림을 전송해야 한다.
- **BE-FR-07:** 전송한 알림에 대해 클라이언트의 수신 여부 응답을 처리할 수 있어야 한다.

### **2. 응급 현장 스트리밍**

- **BE-FR-08:** WebRTC 시그널링 서버 역할을 수행하여, 로봇의 영상을 스트리밍하는 홈 허브와 시청 클라이언트(FE) 간의 P2P 연결을 중계해야 한다.

### **3. 생활 패턴 분석 및 이상치 감지**

- **BE-FR-09:** 개인화된 AI 모델의 가중치(Weights)를 저장하고 관리할 수 있어야 한다. (DB BLOB 또는 오브젝트 스토리지 사용)
- **BE-FR-10:** 단일 AI 모델에 사용자별 가중치를 동적으로 적용하여, 여러 어르신의 생활 패턴을 실시간으로 분석하고 이상치를 감지해야 한다.
- **BE-FR-11:** GPU 서버를 활용하여, 축적된 로그 데이터로 기존 AI 모델의 가중치를 재학습하고 업데이트하는 파이프라인을 제공해야 한다.
- **BE-FR-12:** AI 모델의 출력이 비정상적이거나 없을 경우, 이를 예외 상황으로 감지하고 처리해야 한다.
- **BE-FR-13:** AI 모델의 비정상 출력에 대한 상세 내용을 로그로 기록하여, 모델 개선을 위한 피드백 시스템의 기반을 마련해야 한다.

### **4. IoT 시스템 - 안전 확인 로봇**

- **BE-FR-14:** AI 시스템이 이상치를 감지했을 때, 홈 허브를 통해 안전 확인 로봇에게 출동 및 확인 명령을 전송해야 한다.
- **BE-FR-15:** 안전 확인 로봇의 동작 결과를 홈 허브를 통해 수신하여 후속 조치를 처리해야 한다.

### **5. IoT 시스템 - 홈 센서 시스템**

- **BE-FR-16:** 홈 센서로부터 발생한 이벤트 로그를 `[타임스탬프] [센서 위치] [이벤트 내용]` 형식의 시계열 데이터로 저장하고 조회할 수 있어야 한다.
- **BE-FR-17:** 홈 허브와의 네트워크 연결이 끊겼을 경우, 해당 어르신의 상태를 '통신 안됨'으로 표시해야 한다.
- **BE-FR-18:** 홈 허브와의 네트워크가 복구되었을 때, 연결이 끊겨있던 동안 쌓인 이벤트 로그를 일괄적으로 수신해야 한다.
- **BE-FR-19:** 일괄 수신된 지연 로그를 정상 로그와 동일한 로직으로 처리하여 생활 패턴 분석에 반영해야 한다.