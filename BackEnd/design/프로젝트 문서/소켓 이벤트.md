---
### ## 이벤트 이름 규칙 (Naming Convention)

코드의 가독성을 높이기 위해, 이벤트 이름에 송신자를 기준으로 접두사를 붙이는 규칙을 사용하면 좋습니다.
* `client:*`: 클라이언트(로봇, FE)가 서버로 보내는 이벤트
* `server:*`: 서버가 클라이언트에게 보내는 이벤트

---
### ## 1. 기본 연결 및 인증 이벤트

WebRTC 통신에 앞서, 모든 클라이언트는 연결 및 인증 과정을 거칩니다.

| 이벤트 이름 | 송신자 | 수신자 | 데이터(Payload) 예시 | 설명 |
| :--- | :--- | :--- | :--- | :--- |
| **`connect`** | (내장) | 서버 | (없음) | 클라이언트가 서버에 성공적으로 연결되었을 때 자동으로 발생 |
| **`authenticate`** | 클라이언트 | 서버 | `{"token": "..."}` | 연결 직후, 클라이언트가 자신의 신원(API 키, JWT 등)을 서버에 알려 인증받는 이벤트 |
| **`disconnect`** | (내장) | 서버 | (없음) | 클라이언트의 연결이 끊겼을 때 자동으로 발생 |

---
### ## 2. WebRTC 시그널링 이벤트

인증이 완료된 클라이언트들이 WebRTC 연결을 위해 주고받는 핵심 이벤트들입니다.

| 이벤트 이름 | 송신자 | 수신자 | 데이터(Payload) 예시 | 설명 |
| :--- | :--- | :--- | :--- | :--- |
| **`client:register_offer`** | 로봇 | 서버 | `{"sdp": "...", "ice_candidates": [...]}` | **(흐름 3)** 응급 상황 발생 시, 로봇이 자신의 Offer와 수집된 ICE Candidate들을 서버에 등록 |
| **`server:new_offer`** | 서버 | FE | `{"robot_id": 1, "sdp": "...", "ice_candidates": [...]}` | **(흐름 4)** 서버가 FE에게 로봇의 스트림이 준비되었음을 Offer와 Candidate 정보를 담아 전달 |
| **`client:send_answer`** | FE | 서버 | `{"robot_id": 1, "sdp": "..."}` | **(흐름 6)** FE가 Offer에 대한 응답으로 자신의 Answer를 생성하여 서버에 제출 |
| **`server:new_answer`** | 서버 | 로봇 | `{"sdp": "..."}` | **(흐름 7)** 서버가 FE의 Answer를 로봇에게 전달 |
| **`client:send_ice_candidate`** | 로봇 / FE | 서버 | `{"target_sid": "...", "candidate": {...}}` | **(흐름 6, 8)** 연결 과정 중, 양측이 새롭게 발견한 ICE Candidate를 서버로 전송 |
| **`server:new_ice_candidate`** | 서버 | 로봇 / FE | `{"candidate": {...}}` | **(흐름 7, 9)** 서버가 한쪽에서 받은 ICE Candidate를 상대방에게 중계 |

---
### ## 이벤트 흐름 요약

1.  **로봇**과 **FE**가 각각 서버에 접속하여 **`connect`** 후 **`authenticate`** 이벤트를 보냅니다. 서버는 Redis에 `sid`와 사용자 정보를 매핑합니다.
2.  응급 상황 시, **로봇**이 **`client:register_offer`** 이벤트를 서버로 보냅니다.
3.  **서버**는 해당 로봇(어르신)을 담당하는 **FE**의 `sid`를 Redis에서 찾아 **`server:new_offer`** 이벤트를 보냅니다.
4.  **FE**는 `Answer`를 생성하여 **`client:send_answer`** 이벤트를 서버로 보냅니다.
5.  **서버**는 **로봇**의 `sid`를 찾아 **`server:new_answer`** 이벤트를 보냅니다.
6.  이후 P2P 연결이 수립될 때까지, 양측은 **`client:send_ice_candidate`**를 계속 보내고, 서버는 이를 받아 **`server:new_ice_candidate`**로 상대방에게 중계합니다.